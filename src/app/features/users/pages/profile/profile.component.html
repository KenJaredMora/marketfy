<div class="profile-page">
  <div class="container">
    <div class="profile-header">
      <h1>My Profile</h1>
      <p>Manage your personal information and preferences</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading()" class="loading-state">
      <mat-spinner></mat-spinner>
      <p>Loading profile...</p>
    </div>

    <!-- Profile Content -->
    <div *ngIf="!loading()" class="profile-content">
      <!-- Profile Avatar Card -->
      <mat-card class="profile-avatar-card">
        <mat-card-content>
          <div class="avatar-container">
            <div class="avatar">
              <mat-icon>account_circle</mat-icon>
            </div>
            <div class="avatar-info">
              <h2>{{ form.get('displayName')?.value || 'User' }}</h2>
              <p>{{ form.get('email')?.value }}</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Profile Form Card -->
      <mat-card class="profile-form-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>person</mat-icon>
            Personal Information
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="form" (ngSubmit)="save()">
            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Display Name</mat-label>
                <input matInput formControlName="displayName" required>
                <mat-icon matPrefix>badge</mat-icon>
                <mat-error *ngIf="form.get('displayName')?.hasError('required')">
                  Display name is required
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Email</mat-label>
                <input matInput formControlName="email" type="email">
                <mat-icon matPrefix>email</mat-icon>
                <mat-hint>Email cannot be changed</mat-hint>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>First Name</mat-label>
                <input matInput formControlName="firstName">
                <mat-icon matPrefix>person_outline</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Last Name</mat-label>
                <input matInput formControlName="lastName">
                <mat-icon matPrefix>person_outline</mat-icon>
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Bio</mat-label>
              <textarea matInput
                        formControlName="bio"
                        rows="4"
                        maxlength="500"
                        placeholder="Tell us about yourself..."></textarea>
              <mat-icon matPrefix>description</mat-icon>
              <mat-hint align="end">{{ bioLength }}/500</mat-hint>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Areas of Interest</mat-label>
              <input matInput
                     formControlName="interests"
                     placeholder="e.g., Electronics, Fashion, Books (comma separated)">
              <mat-icon matPrefix>interests</mat-icon>
              <mat-hint>Separate interests with commas</mat-hint>
            </mat-form-field>

            <!-- Interest Tags Preview -->
            <div class="interest-tags" *ngIf="interestTags().length > 0">
              <label>Current Interests:</label>
              <mat-chip-set>
                <mat-chip *ngFor="let tag of interestTags()"
                          highlighted
                          (removed)="removeInterest(tag)">
                  {{ tag }}
                  <button matChipRemove>
                    <mat-icon>cancel</mat-icon>
                  </button>
                </mat-chip>
              </mat-chip-set>
            </div>

            <div class="form-actions">
              <button mat-raised-button
                      color="primary"
                      type="submit"
                      [disabled]="form.invalid || saving()">
                <mat-spinner *ngIf="saving()" diameter="20"></mat-spinner>
                <mat-icon *ngIf="!saving()">save</mat-icon>
                {{ saving() ? 'Saving...' : 'Save Changes' }}
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
